name: Deploy website
on:
   push:
      branches:
         - main
jobs:
   test:
      runs-on: ubuntu-latest
      steps:
         - name: Get code
           uses: actions/checkout@v3
         - name: Install dependencies

           run: yarn install --frozen-lockfile
         - name: Lint code
           run: yarn lint
         - name: Test code
           run: yarn test
   build:
      needs: test
      runs-on: ubuntu-latest
      outputs:
         artifact-name: ${{ steps.set-output.outputs.artifact-name }}
      steps:
         - name: Get code
           uses: actions/checkout@v3
         - name: Install dependencies
           run: yarn install --frozen-lockfile
         - name: Build website
           run: yarn build
         - name: Upload artifacts
           uses: actions/upload-artifact@v3 # action to upload the artifacts or the produced result fo a job
           with:
              name: dist file
              path: dist # path to file of folter to upload
         - name: Set output
           id: set-output
           run: echo "artifact-name=dist-file" >> $GITHUB_ENV
   deploy:
      needs: build
      runs-on: ubuntu-latest
      steps:
         - name: Download artifacts
           uses: actions/download-artifact@v3 # action to download the artifacts or the produced result of a prev job
           with:
              name: dist file # should be the same step name of the upload
         - name: Output the artifact file list
           run: ls
         - name: Show the artifact file name
           run: echo "${{ needs.build.outputs.artifact-name }}"
         - name: Deploy
           run: echo "Deploying..."
